/*! For license information please see viewer.ya1_JdPlG.js.LICENSE.txt */
(()=>{"use strict";var t={300:(t,e,i)=>{i.r(e)}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=class{util=null;dialog=null;rendered=!1;openButton=null;closeButton=null;constructor(t,e=null){this.name=t,this.util=o,this.openButton=e,null!=this.openButton&&this.openButton.addEventListener("click",this.open.bind(this)),this.render(),this.init(),null!=this.closeButton&&this.closeButton.addEventListener("click",this.close.bind(this))}async open(){await this.overlayManager.open(this.dialog)}async close(){await this.overlayManager.close(this.dialog)}render(){let t=this.name+"Dialog",e=document.getElementById("dialogContainer");this.closeButton=this.util.create("button",{id:this.name+"Close",class:"dialogButton"},this.util.getSetting("translations.close"));let i=this.util.create("div",{class:"buttonRow"},this.closeButton);this.dialog=this.util.create("dialog",{id:t,class:"customDialog"},i),e.appendChild(this.dialog)}init(){this.overlayManager=PDFViewerApplication.overlayManager,this.overlayManager.register(this.dialog)}};const e=class extends t{#t=null;constructor(){super("alert"),this.updateDialog()}show(t){this.#t.innerHTML=t,this.open()}updateDialog(){this.#t=this.util.create("div",{class:"alert-message"},""),this.dialog.prepend(this.#t)}};const n=class extends t{#t=null;#e=null;#i=null;#n=null;constructor(t,e){super("library",t),this.pdfAlert=e,this.updateDialog(),this.#e=document.getElementById("loading")}change(){this.util.addClass(this.#e,"show"),this.close();let t=this.#i.added,e=t?"del":"add",i={nonce:this.util.getParam("nonce"),action:this.util.getSetting(`actions.${e}_library`)};t?i.id=this.#i.library_id:(i.post=this.util.getParam("view"),i.attachment=this.#i.id),this.util.ajax(i,(e=>{e.success&&(this.#i.added=!t,this.#i.library_id=e.library_id??null,this.updateView()),this.util.removeClass(this.#e,"show"),this.pdfAlert.show(e.message)}),(t=>{this.util.removeClass(this.#e,"show"),this.pdfAlert.show(t.message)}))}setAttachment(t){this.#i=t,this.updateView(),this.openButton.style.display=null}updateView(){let t;this.#i.added?(t="del",this.util.addClass(this.openButton,"added")):(t="add",this.util.removeClass(this.openButton,"added"));let e=this.util.getSetting(`translations.${t}_library.button_text`);this.#t.innerHTML=this.util.getSetting(`translations.${t}_library.message`),this.openButton.title=e,this.openButton.innerHTML=`<span>${e}</span>`,this.#n.innerHTML=e}updateDialog(){this.#t=this.util.create("div",{class:"library-message"}),this.dialog.prepend(this.#t),this.closeButton.innerHTML=this.util.getSetting("translations.cancel"),this.#n=this.util.create("button",{class:"dialogButton btn-primary",id:this.name+"Confirm"}),this.#n.addEventListener("click",this.change.bind(this)),this.closeButton.parentElement.prepend(this.#n)}};const a=class extends t{#a={};#s=null;#o={};constructor(t,e,i){super("change",t),this.pdfAlert=e,this.#o=i,1==o.getSetting("library_enabled")&&(this.#s=new n(document.getElementById("library"),e)),this.updateDialog()}updateDialog(){let t=this.#o,e=Object.keys(t),i=e.length,n=!1;if(i>1){this.openButton.style.display=null;let e,a=this.util.create("div",{class:"separator"}),s=[],l=1;document.querySelector("#change .change-count").innerHTML=i;let r=o.getSetting("show_modal_on_load",!1);for(e in n=!r||o.getSetting("show_first_attachment",!1),t){let t,o,r,c,d=this.#o[e];t=this.util.create("span",{},d.title),r=this.util.create("span",{class:"loaded"},`(${this.util.getSetting("translations.viewing")})`),c=this.util.create("div",{class:"pair-key"},[t,r]),o=this.util.create("button",{dataset:{target:e},class:"pair-value dialogButton btn-primary"},this.util.getSetting("translations.view")),o.addEventListener("click",this.change.bind(this)),s.push(this.util.create("div",{class:"pair-row"+(n&&1==l?" active":"")},[c,o])),l<i&&s.push(a),l++}this.dialog.prepend(...s),r&&this.open()}else n=!0,this.openButton.parentNode.removeChild(this.openButton);n&&this.changeto(this.util.getParam("target",e[0]))}changeto(t){let e=!1;if("object"==typeof this.#a&&this.#a.id==t)e=!0;else{"object"!=typeof this.#o[t]&&(t=Object.keys(this.#o)[0]);let i=this.#o[t];"object"==typeof i&&(PDFViewerApplication.open(i.file),this.#a=i,e=!0,null!=this.#s&&this.#s.setAttachment(i))}return e}change(t){let e=t.target;this.changeto(e.getAttribute("data-target"))&&(document.querySelectorAll(".pair-row.active").forEach((function(t){t.classList.remove("active")})),e.parentElement.classList.add("active"),this.close())}},s={on:(t,e,i=null)=>{null==i&&(i=window),i&&(i.attachEvent?"complete"===document.readyState||"interactive"===document.readyState?i.attachEvent("on"+t,e):setTimeout(argument.callee,0):i.addEventListener(t,e))},addClass:(t,e)=>{"string"==typeof e&&(e=e.split(" ")),t.classList.add(...e)},removeClass:(t,e)=>{"string"==typeof e&&(e=e.split(" ")),t.classList.remove(...e)},create:(t,e,i=[])=>{let n=document.createElement(t);if(void 0!==e.class&&(s.addClass(n,e.class),delete e.class),void 0!==e.dataset){for(let t in e.dataset)n.dataset[t]=e.dataset[t];delete e.dataset}return Object.assign(n,e),Array.isArray(i)?i.forEach((function(t){n.appendChild(t)})):"string"==typeof i?n.innerHTML=i:n.appendChild(i),n},remove:t=>{Array.isArray(t)||t instanceof NodeList?t.forEach(s.remove):null!=t&&t.parentNode.removeChild(t)},getParam:(t,e=!1)=>{const i=new URL(window.location.href).searchParams;return i.has(t)?i.get(t):e},getSetting:(t,e=!1)=>{let i=window.VIEWER_CONFIG,n=e,a=t.split(".");if(void 0!==i){let t=i;for(let i=0;i<a.length;i++){if(void 0===t[a[i]]){t=e;break}t=t[a[i]]}n=t}return n},ajax:async(t={},e,i=null)=>("function"!=typeof i&&(i=t=>{console.log(t)}),await fetch(s.getSetting("ajax_url"),{method:"POST",body:new URLSearchParams(t)}).then((async t=>{if(t.ok){let i={};try{i=await t.json(),i=i.data}catch(e){i=await t.text()}return e(i)}return t.text().then(i)})).catch(i))},o=s;i(300),function(){let t;function i(){let t=o.getSetting("disrupt_redirect");0!=t&&(window.location.href=t)}function n(t){if(1==o.getSetting("disrupt_devtools")){isNaN(+t)&&(t=60);let e=+new Date,n=+new Date;if(isNaN(e)||isNaN(n)||n-e>t)return i(),!0}return!1}o.on("webviewerloaded",(async()=>{if("undefined"!=typeof PDFViewerApplication&&PDFViewerApplication.initializedPromise.then((()=>{t=new e})),"undefined"!=typeof PDFViewerApplicationOptions&&(PDFViewerApplicationOptions.setAll({defaultUrl:"",disablePreferences:1,locale:o.getSetting("locale","en-US"),textLayerMode:o.getSetting("disable_selection")?0:1}),o.remove(document.querySelectorAll(".js-remove")),!n())){await o.ajax({nonce:o.getParam("nonce",0),action:o.getSetting("actions.get_url",""),target:o.getParam("view",0)},(e=>{"object"==typeof e?new a(document.getElementById("change"),t,e):"string"==typeof e&&t.show(e)}))}})),1==o.getSetting("disable_contextmenu")&&o.on("contextmenu",(t=>t.preventDefault())),1==o.getSetting("disable_open")&&o.on("keydown",(function(t){if(t.ctrlKey&&79==t.which)return t.preventDefault(),!1})),1==o.getSetting("disable_print")&&o.on("keydown",(function(t){if(t.ctrlKey&&80==t.which)return t.preventDefault(),!1})),1==o.getSetting("disable_download")&&o.on("keydown",(function(t){if(t.ctrlKey&&83==t.which)return t.preventDefault(),!1})),1==o.getSetting("disrupt_devtools")&&(o.on("keydown",(function(t){if(123==t.keyCode)return!1;(t.ctrlKey&&t.shiftKey&&73==t.keyCode||t.ctrlKey&&t.shiftKey&&74==t.keyCode)&&i()})),o.on("load",n),o.on("blur",n),o.on("focus",n),o.on("resize",n),o.on("mousemove",n))}()})()})();