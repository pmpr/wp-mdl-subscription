(()=>{"use strict";const t=class{util=null;dialog=null;rendered=!1;openButton=null;closeButton=null;constructor(t,e=null){this.name=t,this.util=s,this.openButton=e,null!=this.openButton&&this.openButton.addEventListener("click",this.open.bind(this)),this.render(),this.init(),null!=this.closeButton&&this.closeButton.addEventListener("click",this.close.bind(this))}async open(){await this.overlayManager.open(this.dialog)}async close(){await this.overlayManager.close(this.dialog)}render(){let t=this.name+"Dialog",e=document.getElementById("dialogContainer");this.closeButton=this.util.create("button",{id:this.name+"Close",class:"dialogButton"},this.util.getSetting("translations.close"));let i=this.util.create("div",{class:"buttonRow"},this.closeButton);this.dialog=this.util.create("dialog",{id:t,class:"customDialog"},i),e.appendChild(this.dialog)}init(){this.overlayManager=PDFViewerApplication.overlayManager,this.overlayManager.register(this.dialog)}};const e=class extends t{#t=null;constructor(){super("alert"),this.updateDialog()}show(t){this.#t.innerHTML=t,this.open()}updateDialog(){this.#t=this.util.create("div",{class:"alert-message"},""),this.dialog.prepend(this.#t)}};const i=class extends t{#t=null;#e=null;#i=null;#n=null;constructor(t,e){super("library",t),this.pdfAlert=e,this.updateDialog(),this.#e=document.getElementById("loading")}change(){this.util.addClass(this.#e,"show"),this.close();let t=this.#i.added,e=t?"del":"add",i={nonce:this.util.getParam("nonce"),action:this.util.getSetting(`actions.${e}_library`)};t?i.id=this.#i.library_id:(i.post=this.util.getParam("view"),i.attachment=this.#i.id),this.util.ajax(i,(e=>{e.success&&(this.#i.added=!t,this.#i.library_id=e.library_id??null,this.updateView()),this.util.removeClass(this.#e,"show"),this.pdfAlert.show(e.message)}),(t=>{this.util.removeClass(this.#e,"show"),this.pdfAlert.show(t.message)}))}setAttachment(t){this.#i=t,this.updateView(),this.openButton.style.display=null}updateView(){let t;this.#i.added?(t="del",this.util.addClass(this.openButton,"added")):(t="add",this.util.removeClass(this.openButton,"added"));let e=this.util.getSetting(`translations.${t}_library.button_text`);this.#t.innerHTML=this.util.getSetting(`translations.${t}_library.message`),this.openButton.title=e,this.openButton.innerHTML=`<span>${e}</span>`,this.#n.innerHTML=e}updateDialog(){this.#t=this.util.create("div",{class:"library-message"}),this.dialog.prepend(this.#t),this.closeButton.innerHTML=this.util.getSetting("translations.cancel"),this.#n=this.util.create("button",{class:"dialogButton",id:this.name+"Confirm"}),this.#n.addEventListener("click",this.change.bind(this)),this.closeButton.parentElement.prepend(this.#n)}};const n=class extends t{#a={};#s=null;#l={};constructor(t,e,n){super("change",t),this.pdfAlert=e,this.#l=n,1==s.getSetting("library_enabled")&&(this.#s=new i(document.getElementById("library"),e)),this.updateDialog()}updateDialog(){let t=this.#l,e=Object.keys(t),i=e.length;if(this.changeto(this.util.getParam("target",e[0])),i>1){this.openButton.style.display=null;let e,n=this.util.create("div",{class:"separator"}),a=[],s=1;for(e in document.querySelector("#change .change-count").innerHTML=i,t){let t,l,o=this.#l[e];t=this.util.create("span",{class:"pair-key"},o.title),l=this.util.create("button",{dataset:{target:e},class:"pair-value dialogButton"},this.util.getSetting("translations.view")),l.addEventListener("click",this.change.bind(this)),a.push(this.util.create("div",{class:"pair-row"+(1==s?" active":"")},[t,l])),s<i&&a.push(n),s++}this.dialog.prepend(...a)}else this.openButton.parentNode.removeChild(this.openButton)}changeto(t){let e=!1;if("object"==typeof this.#a&&this.#a.id==t)e=!0;else{"object"!=typeof this.#l[t]&&(t=Object.keys(this.#l)[0]);let i=this.#l[t];"object"==typeof i&&(PDFViewerApplication.open(i.file),this.#a=i,e=!0,null!=this.#s&&this.#s.setAttachment(i))}return e}change(t){let e=t.target;this.changeto(e.getAttribute("data-target"))&&(document.querySelectorAll(".pair-row.active").forEach((function(t){t.classList.remove("active")})),e.parentElement.classList.add("active"),this.close())}},a={on:(t,e,i=null)=>{null==i&&(i=window),i&&(i.attachEvent?"complete"===document.readyState||"interactive"===document.readyState?i.attachEvent("on"+t,e):setTimeout(argument.callee,0):i.addEventListener(t,e))},addClass:(t,e)=>{"string"==typeof e&&(e=e.split(" ")),t.classList.add(...e)},removeClass:(t,e)=>{"string"==typeof e&&(e=e.split(" ")),t.classList.remove(...e)},create:(t,e,i=[])=>{let n=document.createElement(t);if(void 0!==e.class&&(a.addClass(n,e.class),delete e.class),void 0!==e.dataset){for(let t in e.dataset)n.dataset[t]=e.dataset[t];delete e.dataset}return Object.assign(n,e),Array.isArray(i)?i.forEach((function(t){n.appendChild(t)})):"string"==typeof i?n.innerHTML=i:n.appendChild(i),n},remove:t=>{Array.isArray(t)||t instanceof NodeList?t.forEach(a.remove):null!=t&&t.parentNode.removeChild(t)},getParam:(t,e=!1)=>{const i=new URL(window.location.href).searchParams;return i.has(t)?i.get(t):e},getSetting:(t,e=!1)=>{let i=window.VIEWER_CONFIG,n=e,a=t.split(".");if(void 0!==i){let t=i;for(let i=0;i<a.length;i++){if(void 0===t[a[i]]){t=e;break}t=t[a[i]]}n=t}return n},ajax:async(t={},e,i=null)=>("function"!=typeof i&&(i=t=>{console.log(t)}),await fetch(a.getSetting("ajax_url"),{method:"POST",body:new URLSearchParams(t)}).then((async t=>{if(t.ok){let i={};try{i=await t.json(),i=i.data}catch(e){i=await t.text()}return e(i)}return t.text().then(i)})).catch(i))},s=a;!function(){let t;function i(){let t=s.getSetting("disrupt_redirect");0!=t&&(window.location.href=t)}function a(t){if(1==s.getSetting("disrupt_devtools")){isNaN(+t)&&(t=60);let e=+new Date,n=+new Date;if(isNaN(e)||isNaN(n)||n-e>t)return i(),!0}return!1}s.on("webviewerloaded",(async()=>{if("undefined"!=typeof PDFViewerApplication&&PDFViewerApplication.initializedPromise.then((()=>{t=new e})),"undefined"!=typeof PDFViewerApplicationOptions&&(PDFViewerApplicationOptions.setAll({defaultUrl:"",disablePreferences:1,locale:s.getSetting("locale","en-US"),textLayerMode:s.getSetting("text_selection")?1:0}),s.remove(document.querySelectorAll(".js-remove")),!a())){await s.ajax({nonce:s.getParam("nonce",0),action:s.getSetting("actions.get_url",""),target:s.getParam("view",0)},(e=>{"object"==typeof e?new n(document.getElementById("change"),t,e):"string"==typeof e&&t.show(e)}))}})),1==s.getSetting("disable_contextmenu")&&s.on("contextmenu",(t=>t.preventDefault())),1==s.getSetting("disable_open")&&s.on("keydown",(function(t){if(t.ctrlKey&&79==t.which)return t.preventDefault(),!1})),1==s.getSetting("disable_print")&&s.on("keydown",(function(t){if(t.ctrlKey&&80==t.which)return t.preventDefault(),!1})),1==s.getSetting("disable_download")&&s.on("keydown",(function(t){if(t.ctrlKey&&83==t.which)return t.preventDefault(),!1})),1==s.getSetting("disrupt_devtools")&&(s.on("keydown",(function(t){if(123==t.keyCode)return!1;(t.ctrlKey&&t.shiftKey&&73==t.keyCode||t.ctrlKey&&t.shiftKey&&74==t.keyCode)&&i()})),s.on("load",a),s.on("blur",a),s.on("focus",a),s.on("resize",a),s.on("mousemove",a))}()})();